import json
import os
import sqlite3

def sync(db_path: str):
    con = sqlite3.connect(db_path)
    for row in con.cursor().execute("SELECT record from results;"):
        nvd_json = json.loads(row[0])["item"]
        cve_id = nvd_json["cve"]["id"]
        year = cve_id.split("-")[1]
        path = os.path.join("data", year)
        os.makedirs(path, exist_ok=True)

        with open(os.path.join(path, f"{cve_id}.json"), "w") as f:
            json.dump(nvd_json, f, ensure_ascii=False, indent=2)

if __name__ == "__main__":
    sync(".tmp/nvd.db")